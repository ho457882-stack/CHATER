<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Cole Chat</title>
<style>
body{margin:0;font-family:Arial,sans-serif;display:flex;justify-content:center;align-items:center;height:100vh;background:radial-gradient(circle at 30% 30%, #ff8c00, #ff4d4d, #ff69b4);animation:glowBG 12s infinite alternate;}
@keyframes glowBG{0%{background-position:0% 50%;}50%{background-position:100% 50%;}100%{background-position:0% 50%;}}
.chat-container{width:500px;height:680px;display:flex;flex-direction:column;overflow:hidden;position:relative;border-radius:25px;background:linear-gradient(145deg, rgba(255,140,0,0.95), rgba(255,77,77,0.95), rgba(255,105,180,0.95));box-shadow:0 0 60px #ff8c00,0 0 80px #ff4d4d;border:2px solid #ff69b4;}
.chat-header{background:linear-gradient(90deg,#ff8c00,#ff4d4d,#ff69b4);padding:20px;text-align:center;font-size:1.6em;font-weight:bold;color:white;text-shadow:0 0 10px #ff69b4;border-bottom:2px solid #ff69b4;}
.chat-box{flex:1;padding:15px;overflow-y:auto;display:flex;flex-direction:column;gap:12px;scroll-behavior:smooth;background:rgba(255,182,193,0.2);border-radius:0 0 25px 25px;}
.msg{max-width:70%;padding:14px 18px;border-radius:20px;font-size:1em;position:relative;word-break:break-word;background:linear-gradient(135deg,#ff69b4,#ff8c00,#ff4d4d);color:white;box-shadow:0 4px 15px rgba(255,77,77,0.7),0 0 30px #ff8c00;}
.msg.left{align-self:flex-start;border-bottom-left-radius:5px;}
.msg.right{align-self:flex-end;border-bottom-right-radius:5px;}
.reply-preview{font-size:0.85em;padding:5px 12px;border-radius:12px;background:rgba(255,255,255,0.15);margin-bottom:5px;font-style:italic;}
.chat-input{display:flex;padding:12px;background:rgba(255,182,193,0.3);align-items:center;border-top:2px solid #ff69b4;}
.chat-input input{flex:1;padding:12px 15px;border-radius:25px;border:none;outline:none;background:rgba(255,240,245,0.7);color:#333;font-size:1em;}
.chat-input button{margin-left:10px;padding:12px 18px;border-radius:25px;border:none;background:linear-gradient(135deg,#ff69b4,#ff8c00);color:white;font-weight:bold;cursor:pointer;}
.plus-btn{margin-right:10px;padding:10px 15px;border-radius:50%;border:none;font-size:1.2em;background:linear-gradient(135deg,#ff69b4,#ff8c00);cursor:pointer;}
.menu{position:absolute;bottom:70px;left:20px;background:rgba(255,182,193,0.85);border-radius:15px;padding:10px;display:none;flex-direction:column;gap:10px;box-shadow:0 0 20px #ff69b4;}
.menu-item{padding:10px 20px;border-radius:10px;background:linear-gradient(135deg,#ffccdd,#ff99bb);cursor:pointer;font-weight:bold;}
img.chat-media{max-width:150px;border-radius:10px;display:block;}
video.chat-media{max-width:200px;border-radius:10px;display:block;}
.reply-box{position:absolute;bottom:60px;left:20px;right:20px;background:rgba(255,182,193,0.3);padding:5px 10px;border-radius:10px;font-size:0.9em;display:none;color:#333;}
.delete-btn-container{text-align:center;padding:10px;background:rgba(255,182,193,0.2);}
.delete-btn-container button{padding:10px 20px;border:none;border-radius:25px;background:linear-gradient(135deg,#ff99bb,#ff69b4);color:white;font-weight:bold;cursor:pointer;box-shadow:0 0 10px #ff99bb;}
</style>
</head>
<body>
<div class="chat-container">
  <div class="chat-header">Cole Chat</div>
  <div class="chat-box" id="chat-box"></div>
  <div class="reply-box" id="reply-box"></div>
  <div class="chat-input">
    <button class="plus-btn" onclick="toggleMenu()">ï¼‹</button>
    <input type="text" id="msg-input" placeholder="Type a message..."/>
    <button onclick="sendMessage()">Send</button>
  </div>
  <div class="menu" id="menu">
    <div class="menu-item" onclick="chooseFile('image/*')">ðŸ“· Choose Photo</div>
    <div class="menu-item" onclick="chooseFile('video/*')">ðŸŽ¥ Choose Video</div>
  </div>
  <div class="delete-btn-container">
    <button id="delete-convo-btn">Delete Conversation</button>
  </div>
</div>
<input type="file" id="file-input" style="display:none" />

<script>
const BIN_ID="68d0c73543b1c97be94b003c";
const X_MASTER_KEY="$2a$10$XmElrx89KOnIuIu1J7agl.wr42BIkJ9iYFq2gbyTeBsZYzXJxHC.i";
const SENDER="Cole";
let replyTo=null;

const chatBox=document.getElementById("chat-box");
const input=document.getElementById("msg-input");
const replyBox=document.getElementById("reply-box");
const fileInput=document.getElementById("file-input");

function renderMessage(m){
  const div=document.createElement("div");
  div.className="msg "+(m.sender===SENDER?"right":"left");
  if(m.reply){const rep=document.createElement("div");rep.className="reply-preview";rep.textContent=m.reply;div.appendChild(rep);}
  if(m.type==="text") div.appendChild(document.createTextNode(m.text));
  if(m.type==="image"){const img=document.createElement("img");img.src=m.text;img.className="chat-media";div.appendChild(img);}
  if(m.type==="video"){const vid=document.createElement("video");vid.src=m.text;vid.className="chat-media";vid.controls=true;div.appendChild(vid);}
  chatBox.appendChild(div);
}

async function loadMessages(){
  try{
    const res=await fetch(`https://api.jsonbin.io/v3/b/${BIN_ID}/latest`,{headers:{"X-Master-Key": X_MASTER_KEY}});
    const data=await res.json();
    chatBox.innerHTML="";
    const msgs=data.record.messages||[];
    msgs.forEach(renderMessage);
    chatBox.scrollTop=chatBox.scrollHeight;
  }catch(e){console.error(e);}
}

async function sendMessage(){
  const text=input.value.trim();
  if(!text) return;
  input.value="";
  const newMsg={sender:SENDER,type:"text",text,reply:replyTo};
  replyTo=null; replyBox.style.display="none";

  try{
    const res=await fetch(`https://api.jsonbin.io/v3/b/${BIN_ID}/latest`,{headers:{"X-Master-Key": X_MASTER_KEY}});
    const data=await res.json();
    const msgs=data.record.messages||[];
    msgs.push(newMsg);
    await fetch(`https://api.jsonbin.io/v3/b/${BIN_ID}`,{method:"PUT",headers:{"Content-Type":"application/json","X-Master-Key": X_MASTER_KEY},body:JSON.stringify({messages: msgs})});
    renderMessage(newMsg);  // instant
    chatBox.scrollTop=chatBox.scrollHeight;
  }catch(e){console.error(e);}
}

fileInput.addEventListener("change", e=>{
  const file=e.target.files[0];
  if(!file) return;
  const reader=new FileReader();
  reader.onload=async ()=>{
    const kind=file.type.startsWith("image")?"image":"video";
    const newMsg={sender:SENDER,type:kind,text:reader.result,reply:replyTo};
    replyTo=null; replyBox.style.display="none";

    try{
      const res=await fetch(`https://api.jsonbin.io/v3/b/${BIN_ID}/latest`,{headers:{"X-Master-Key": X_MASTER_KEY}});
      const data=await res.json();
      const msgs=data.record.messages||[];
      msgs.push(newMsg);
      await fetch(`https://api.jsonbin.io/v3/b/${BIN_ID}`,{method:"PUT",headers:{"Content-Type":"application/json","X-Master-Key": X_MASTER_KEY},body:JSON.stringify({messages: msgs})});
      renderMessage(newMsg);
      chatBox.scrollTop=chatBox.scrollHeight;
    }catch(e){console.error(e);}
  };
  reader.readAsDataURL(file);
});

function setReply(m){replyTo=m.type==="text"?m.text:(m.type==="image"?"a photo ðŸ“·":"a video ðŸŽ¥");replyBox.textContent="Replying to: "+replyTo;replyBox.style.display="block";}
function toggleMenu(){document.getElementById("menu").style.display=document.getElementById("menu").style.display==="flex"?"none":"flex";}
function chooseFile(type){fileInput.accept=type;fileInput.click();}

document.getElementById("delete-convo-btn").addEventListener("click", async ()=>{
  if(confirm("Delete entire conversation?")){
    await fetch(`https://api.jsonbin.io/v3/b/${BIN_ID}`,{method:"PUT",headers:{"Content-Type":"application/json","X-Master-Key": X_MASTER_KEY},body:JSON.stringify({messages: []})});
    chatBox.innerHTML=""; replyTo=null; replyBox.style.display="none";
  }
});

input.addEventListener("keydown", e=>{if(e.key==="Enter") sendMessage();});
setInterval(loadMessages,1000);
loadMessages();
</script>
</body>
</html>